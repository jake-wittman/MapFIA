spp.id <- db$id
file.list <- list.files(path = "./data/", pattern = ".img", full.names = T)
# The combined spp files are not done yet, so remove them from file list
spp.id <- as.character(spp.id)
index <- grep(paste(spp.id, collapse = "|"), split1)
split1 <- unlist(strsplit(file.list, "a/"))
split1 <- split1[seq(from = 2, to = length(split1), by = 2)]
index <- grep(paste(spp.id, collapse = "|"), split1)
file.list[index]
list.rasters <- lapply(file.list[index], raster)
# Make a list of state shape files
state.shapes <- lapply(states, function(x) {subset(contig.usa, STATE_NAME == x)})
names(state.shapes) <- states
# spp_id <- rep(tree.id, length(states))
# state_df <- rep(states, length(tree.id))
# cbind(spp_id, state_df)
sum.ba <- data.frame(x = tree.id, y = states, z = NA )
sum.ba$x <- as.character(sum.ba$x)
# spp_id <- rep(tree.id, length(states))
# state_df <- rep(states, length(tree.id))
# cbind(spp_id, state_df)
sum.ba <- data.frame(x = tree.id, y = states, z = NA )
# spp_id <- rep(tree.id, length(states))
# state_df <- rep(states, length(tree.id))
# cbind(spp_id, state_df)
sum.ba <- data.frame(x = id, y = states, z = NA )
# spp_id <- rep(tree.id, length(states))
# state_df <- rep(states, length(tree.id))
# cbind(spp_id, state_df)
sum.ba <- data.frame(x = spp.id, y = states, z = NA )
?rep
rep(1:4, 2)
rep(1:4, each = 2)
spp.id
spp.id <- db$spp_code
file.list <- list.files(path = "./data/", pattern = ".img", full.names = T)
# The combined spp files are not done yet, so remove them from file list
spp.id <- as.character(spp.id)
split1 <- unlist(strsplit(file.list, "a/"))
split1 <- split1[seq(from = 2, to = length(split1), by = 2)]
index <- grep(paste(spp.id, collapse = "|"), split1)
file.list[index]
# Make a list of state shape files
state.shapes <- lapply(states, function(x) {subset(contig.usa, STATE_NAME == x)})
names(state.shapes) <- states
spp.id1 <- rep(spp.id, each = length(states))
spp.id1
spp.id.df <- rep(spp.id, each = length(states))
state.df <- rep(states, length(tree.id))
state.df <- rep(states, length(spp.id))
state.df
# cbind(spp_id, state_df)
sum.ba <- data.frame(x = rep(spp.id, each = length(states)),
y = rep(states, length(spp.id)),
z = NA )
sum.ba$x <- as.character(sum.ba$x)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
list.rasters[[1]]
test <- list.rasters[[1]]
test
test@filelist.rasters[[2]]
list.rasters[[2]]
list.rasters[[3]]
spp.id
test@z
test@history
test
names(test)
spp.id <- paste0("s", spp.id)
spp.id
names(test) %in% spp.id
which(names(test) %in% spp.id)
file.list <- list.files(path = "./data/", pattern = ".img", full.names = T)
# The combined spp files are not done yet, so remove them from file list
spp.id <- as.character(spp.id)
split1 <- unlist(strsplit(file.list, "a/"))
split1 <- split1[seq(from = 2, to = length(split1), by = 2)]
index <- grep(paste(spp.id, collapse = "|"), split1)
file.list[index]
list.rasters <- lapply(file.list[index], raster)
# Make a list of state shape files
state.shapes <-
lapply(states, function(x) {
subset(contig.usa, STATE_NAME == x)
})
names(state.shapes) <- states
sum.ba <- data.frame(
x = rep(spp.id, each = length(states)),
y = rep(states, length(spp.id)),
z = NA
)
sum.ba$x <- as.character(sum.ba$x)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
head(sum.ba)
states <- c("Washington", "Montana")
StateStats <- function(rasterfile) {
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(test)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
return(sum.ba)
}
raster.subset <- list.rasters[1:2]
raster.subset
test <- lapply(raster.subset, StateStats)
StateStats <- function(rasterfile) {
print(names(rasterfile))
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
return(sum.ba)
}
states <- c("Rhode Island", "Delaware")
StateStats <- function(rasterfile) {
print(names(rasterfile))
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
return(sum.ba)
}
sum.ba <- data.frame(
x = rep(spp.id, each = length(states)),
y = rep(states, length(spp.id)),
z = NA
)
sum.ba$x <- as.character(sum.ba$x)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
StateStats <- function(rasterfile) {
print(names(rasterfile))
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
return(sum.ba)
}
raster.subset <- list.rasters[1:2]
test <- lapply(raster.subset, StateStats)
test
test <- sapply(raster.subset, StateStats)
test
?apply
?tapply
?lapply
test <- lapply(raster.subset, StateStats)
test[[1]]
StateStats <- function(rasterfile) {
sum.ba <- data.frame(
x = rep(spp.id, length(states)),
y = states,
z = NA
)
print(names(rasterfile))
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
return(sum.ba)
}
test <- lapply(raster.subset, StateStats)
StateStats <- function(rasterfile) {
sum.ba <- data.frame(
x = rep(spp.id, length(states)),
y = states,
z = NA
)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
print(names(rasterfile))
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
return(sum.ba)
}
raster.subset <- list.rasters[1:2]
test <- lapply(raster.subset, StateStats)
test
StateStats <- function(rasterfile) {
sum.ba <- data.frame(
x = rep(names(rasterfile), length(states)),
y = states,
z = NA
)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
print(names(rasterfile))
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
return(sum.ba)
}
raster.subset <- list.rasters[1:2]
test <- lapply(raster.subset, StateStats)
test
v <- unlist(test)
v
?ldply
library(plyr)
library(raster)
library(rgdal)
library(ggplot2)
library(viridis)
library(rasterVis)
library(ggthemes)
v <- ldply(test, data.frame)
v
library(doParallel)
?for each
?foreach
StateStatsParallel <- function(rasterfile) {
sum.ba <- data.frame(x = rep(names(rasterfile), length(states)),
y = states,
z = NA)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
print(names(rasterfile))
sum.ba <- foreach (i = states, .combine = rbind)  %dopar% {
res <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
c(names(rasterfile), state, res)
}
return(sum.ba)
}
test <- lapply(raster.subset, StateStatsParallel)
detectCores()
detectCores() - 1
registerDoParallel(detectCores() - 1)
StateStatsParallel <- function(rasterfile) {
sum.ba <- data.frame(x = rep(names(rasterfile), length(states)),
y = states,
z = NA)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
print(names(rasterfile))
sum.ba <- foreach (i = states, .combine = rbind)  %dopar% {
res <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
c(names(rasterfile), states, res)
}
return(sum.ba)
}
registerDoParallel(detectCores() - 1)
test <- lapply(raster.subset, StateStatsParallel)
library(raster)
test <- lapply(raster.subset, StateStatsParallel)
?foreach
StateStatsParallel <- function(rasterfile) {
sum.ba <- data.frame(x = rep(names(rasterfile), length(states)),
y = states,
z = NA)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
print(names(rasterfile))
sum.ba <- foreach (i = states, .combine = rbind, .packages = "raster")  %dopar% {
res <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
c(names(rasterfile), states, res)
}
return(sum.ba)
}
registerDoParallel(detectCores() - 1)
test <- lapply(raster.subset, StateStatsParallel)
StateStats <- function(rasterfile) {
sum.ba <- data.frame(
x = rep(names(rasterfile), length(states)),
y = states,
z = NA
)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
print(names(rasterfile))
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
return(sum.ba)
}
b <- list.rasters[1]
test <- lapply(states, function(x) {cellStats(mask(crop(b, extent(x)),
x), stat = "sum")})
StatesFun <- function(list.states) {
cellStats(mask(crop(rasterfile, extent(list.states),
list.states), stat = "sum"))
}
StatesFun(state.shapes)
StatesFun <- function(list.states) {
cellStats(mask(crop(b, extent(list.states),
list.states), stat = "sum"))
}
StatesFun(state.shapes)
?write.csv
StateStats <- function(rasterfile) {
sum.ba <- data.frame(
x = rep(names(rasterfile), length(states)),
y = states,
z = NA
)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
print(names(rasterfile))
test <- lapply(states, function(x) {})
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
write.csv(sum.ba, paste0("data/", names(rasterfile), "states_tot_ba.csv"))
return(sum.ba)
}
tot.ba <- lapply(raster.subset, StateStats)
StateStats <- function(rasterfile) {
sum.ba <- data.frame(
x = rep(names(rasterfile), length(states)),
y = states,
z = NA
)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
print(names(rasterfile))
test <- lapply(states, function(x) {})
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
write.csv(sum.ba, paste0("data/", names(rasterfile), "states_tot_ba.csv"))
return(sum.ba)
}
states <- as.character(unique(contig.usa$STATE_NAME))
# Make a list of state shape files
state.shapes <-
lapply(states, function(x) {
subset(contig.usa, STATE_NAME == x)
})
names(state.shapes) <- states
StateStats <- function(rasterfile) {
sum.ba <- data.frame(
x = rep(names(rasterfile), length(states)),
y = states,
z = NA
)
colnames(sum.ba) <- c("spp.id", "state", "tot.ba")
print(names(rasterfile))
test <- lapply(states, function(x) {})
for (i in states) {
sum.ba$tot.ba[sum.ba$state == i & sum.ba$spp.id == names(rasterfile)] <-
cellStats(mask(crop(rasterfile, extent(state.shapes[[paste(i)]])),
state.shapes[[paste(i)]]), stat = "sum")
print(i)
}
write.csv(sum.ba, paste0("data/", names(rasterfile), "states_tot_ba.csv"))
return(sum.ba)
}
sum(1:50)
head(db)
shiny::runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
head(db)
db[db$scientific_name == "Quercus rubra"]
db[db$scientific_name == "Quercus rubra",]
runApp('MapFIA')
runApp('MapFIA')
?updateSelectizeInput
?selectizeInput
runApp('MapFIA')
?observeEvent
head(db)
runApp('MapFIA')
runApp('MapFIA')
shiny::runApp('MapFIA')
runApp('MapFIA')
shiny::runApp('MapFIA')
install.packages("googledrive")
runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
runApp('MapFIA')
library(googledrive)
drive_find
?googledrive
??googledrive
drive_find(n_max = 50)
save(red.oak, "test")
save(red.oak, file = test)
save(red.oak, file = "test.RData"
)
load(test)
load("test.RData")
v <- load("test.RData")
v
plot(load("test.RData"))
x <- drive_get("s927.img")
View(x)
test <-raster(x$id)
test <-raster(drive_download("s927.img"))
?saveRDS
saveRDS(red.oak, file = "test.rds")
readRDS("test.rds")
v <- readRDS("test.rds")
x <- drive_get("s927.img")
test <-raster(drive_download("s927.img"))
test <- raster(drive_download("s927.img", overwrite = T))
test
rm(test)
test <- raster(drive_download("s927.img", overwrite = T))
test <- drive_download("s927.img", overwrite = T)
test
test <- drive_download("s927.img", overwrite = T)
test
s <- "s927.img"
namefile <- s
namefile
obj <- drive_download(namefile, overwrite = T)
obj
raster(obj$local_path)
v <- raster(obj$local_path)
x <- drive_get("s927.img")
x
input$scientific.name <- c("Quercus rubra", "Quercas alba", "Acer negundo")
input <- data.frame()
input$scientific.name <- c("Quercus rubra", "Quercas alba", "Acer negundo")
input <- data.frame(nrow = 3)
input$scientific.name <- c("Quercus rubra", "Quercas alba", "Acer negundo")
scientific.name <- as.data.frame(c("Quercus rubra", "Quercas alba", "Acer negundo"))
input <- as.data.frame(c("Quercus rubra", "Quercas alba", "Acer negundo"))
colnames(input) <- "scientific.names"
input
head(db)
id <- db$id[db$scientific_name == input$scientific.names]
str(db)
str(input)
db$scientific_name <- as.character(db$scientific_name)
str(db)
id <- db$id[db$scientific_name == input$scientific.names]
id
View(db)
input <- as.data.frame(c("Quercus rubra", "Quercus alba", "Acer negundo"))
colnames(input) <- "scientific.names"
id <- db$id[db$scientific_name == input$scientific.names]
id
input <- as.data.frame(c("Quercus rubra", "Quercus alba", "Acer negundo"))
colnames(input) <- "scientific.names"
id <- db$id[db$scientific_name == input$scientific.names]
id
id <- db$id[db$scientific_name == "Quercus alba"]
id
db$scientific_name <- as.character(db$scientific_name)
input <- as.data.frame(c("Quercus rubra", "Quercus alba", "Acer negundo"))
colnames(input) <- "scientific.names"
id <- db$id[db$scientific_name == input$scientific.names]
id <- db$id[db$scientific_name %in% input$scientific.names]
id
ras.info <- drive_get(id)
ras.info
dl <- drive_download(id)
?drive_download
obj
list(obj, obj)
dl.list <- list()
which(id)
which(id == "s927.img")
ras.info
i == 1
i = 1
which(id == id[i])
dl.list <- list()
for (i in id){
dl.list[which(id == id[i])] <- drive_download(id)
}
for (i in id){
dl.list[which(id == id[i])] <- drive_download(id[i])
}
id[1]
for (i in 1:length(id)) {
dl.list[which(id == id[i])] <- drive_download(id[i])
}
dl.list
plot((raster(dl.list[1]))
plot((raster(dl.list[1])))
plot((raster(dl.list[[1]])))
dl.list
ras.list <- lapply(dl.list, raster)
ras.list
plot(ras.list[[1]])
sum.ras.list <- lapply(ras.list, sum)
sum(sum.ras.list)
sum(sum.ras.list[[1]] + sum.ras.list[[2]])
plot(sum.ras.list <- lapply(ras.list, sum))
